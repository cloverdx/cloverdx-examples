<?xml version="1.0" encoding="UTF-8"?>
<Graph author="Honza" created="Wed Oct 05 11:03:29 CEST 2022" guiVersion="7.2.1.7" id="1665127014040" licenseCode="CLCDSCLOVE24765514SP" name="DQExample1" showComponentDetails="true">
<Global>
<Metadata id="Metadata0">
<Record fieldDelimiter="|" name="Donations" previewAttachmentCharset="UTF-8" recordDelimiter="\r\n" type="delimited">
<Field label="Year" name="Year" type="integer"/>
<Field label="Electoral Event" name="Electoral_Event" type="string"/>
<Field label="Source" name="Source" type="string"/>
<Field label="Contributor Type" name="Contributor_Type" type="string"/>
<Field label="Contributor" name="Contributor" type="string"/>
<Field label="Contributor City/Province/Postal" name="Contributor_City_Province_Postal" type="string"/>
<Field label="Recipient" name="Recipient" type="string"/>
<Field label="Political Party" name="Political_Party" type="string"/>
<Field label="Political Entity" name="Political_Entity" type="string"/>
<Field label="Total Amount" name="Total_Amount" type="string"/>
<Field auto_filling="source_name" name="SourceFileURL" type="string"/>
</Record>
</Metadata>
<Metadata id="Metadata1">
<Record fieldDelimiter="|" name="DonationsTyped" previewAttachmentCharset="UTF-8" recordDelimiter="\r\n" type="delimited">
<Field label="Year" name="Year" type="integer"/>
<Field label="Electoral Event" name="Electoral_Event" type="string"/>
<Field label="Source" name="Source" type="string"/>
<Field label="Contributor Type" name="Contributor_Type" type="string"/>
<Field label="Contributor" name="Contributor" type="string"/>
<Field label="Contributor City/Province/Postal" name="Contributor_City_Province_Postal" type="string"/>
<Field label="Recipient" name="Recipient" type="string"/>
<Field label="Political Party" name="Political_Party" type="string"/>
<Field label="Political Entity" name="Political_Entity" type="string"/>
<Field label="Total Amount" name="Total_Amount" type="decimal"/>
</Record>
</Metadata>
<Metadata id="Metadata2">
<Record fieldDelimiter="|" name="ValidationResult" previewAttachmentCharset="UTF-8" recordDelimiter="\n" type="delimited">
<Field label="Year" name="Year" type="integer"/>
<Field label="Electoral Event" name="Electoral_Event" type="string"/>
<Field label="Source" name="Source" type="string"/>
<Field label="Contributor Type" name="Contributor_Type" type="string"/>
<Field label="Contributor" name="Contributor" type="string"/>
<Field label="Contributor City/Province/Postal" name="Contributor_City_Province_Postal" type="string"/>
<Field label="Recipient" name="Recipient" type="string"/>
<Field label="Political Party" name="Political_Party" type="string"/>
<Field label="Political Entity" name="Political_Entity" type="string"/>
<Field label="Total Amount" name="Total_Amount" type="string"/>
<Field name="SourceFileURL" type="string"/>
<Field name="recordNo" trim="true" type="long"/>
<Field name="validationMessage" type="string"/>
<Field name="ruleStatusCode" trim="true" type="integer"/>
<Field name="ruleName" type="string"/>
<Field name="ruleType" type="string"/>
<Field containerType="list" name="rulePath" type="string"/>
<Field containerType="list" name="validatedFieldNames" type="string"/>
<Field containerType="map" name="validatedValues" type="string"/>
<Field containerType="map" name="ruleParameters" type="string"/>
<Field name="validationDate" trim="true" type="date"/>
</Record>
</Metadata>
<GraphParameters>
<GraphParameterFile fileURL="workspace.prm"/>
</GraphParameters>
<RichTextNote backgroundColor="FAF6D6" folded="false" fontSize="medium" height="151" id="Note0" textColor="444444" width="551" x="125" y="150">
<attr name="text"><![CDATA[h1. Initial data validation

Use the readerâ€™s second output port for basic validation. The same can also be validated with Validator component and it is up to you to decide which approach is better. In this case, validating whether a year is a number can be easily done during parsing while more complex rules are implemented in Validator.]]></attr>
</RichTextNote>
<RichTextNote backgroundColor="FAF6D6" folded="false" fontSize="medium" height="250" id="Note1" textColor="444444" width="275" x="50" y="500">
<attr name="text"><![CDATA[h3. Autofilling in metadata

We use SourceFileURL field in metadata to get the URL of the input file so that we can then see it in the error detail record.

Without this, the error messages would not provide any information about the file (since Validator does not know the data comes from a file).]]></attr>
</RichTextNote>
<Dictionary/>
</Global>
<Phase number="0">
<Node debugPrint="true" guiName="Catch errors" guiX="395" guiY="550" id="CATCH_ERRORS" type="TRASH">
<attr name="guiDescription"><![CDATA[log invalid records]]></attr>
</Node>
<Node fileURL="${DATAIN_DIR}/*.xlsx" guiName="Donations Spreadsheet" guiX="120" guiY="350" id="DONATIONS_SPREADSHEET" type="SPREADSHEET_READER">
<attr name="guiDescription"><![CDATA[Read donations data from the XLSX spreadsheet]]></attr>
</Node>
<Node excludeFields="rulePath;validatedFieldNames;ruleParameters;validatedValues" fileURL="${DATAOUT_DIR}/InvalidDonations.data" guiName="Invalid donations" guiX="645" guiY="550" id="INVALID_DONATIONS" outputFieldNames="true" type="FLAT_FILE_WRITER"/>
<Node guiName="Validator" guiX="395" guiY="350" id="VALIDATOR" type="VALIDATOR">
<attr name="rules"><![CDATA[<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<group conjunction="AND" description="" enabled="true" errorMessage="" errorMessageProducer="RULES" lazyEvaluation="true" name="All rules" statusCode="">
    <children>
        <copyAllByName customRejectMessage="" description="" enabled="true" inputField="" name="Copy all fields by name" outputField=""/>
        <interval acceptEmpty="false" boundaries="CLOSED_CLOSED" customRejectMessage="Year value not in the required range" description="" enabled="true" from="1990" inputField="Year" name="Is Year value in range between 1990 and 2030?" outputField="Year" to="2030" useType="DEFAULT">
            <languageSetting dateFormat="" locale="" numberFormat="" timezone=""/>
        </interval>
        <isNumber acceptEmpty="false" customRejectMessage="Amount must be non-empty and a number" description="" enabled="true" inputField="Total_Amount" name="Is Number" numberType="DECIMAL" outputField="Total_Amount" trimInput="false">
            <languageSetting dateFormat="" locale="" numberFormat="" timezone=""/>
        </isNumber>
        <nonEmptyField customRejectMessage="Recipient cannot be empty" description="" enabled="true" goal="NONEMPTY" inputField="Recipient" name="Empty/Nonempty field" outputField="" trimInput="false"/>
    </children>
    <languageSetting dateFormat="" locale="" numberFormat="" timezone=""/>
    <imports/>
</group>
]]></attr>
<attr name="errorMapping"><![CDATA[//#CTL2

function integer transform() {
	$out.1.* = $in.1.*;
	$out.1.* = $in.0.*;

	return ALL;
}
]]></attr>
</Node>
<Node fileURL="${DATAOUT_DIR}/ValidDonations.data" guiName="Valid donations" guiX="645" guiY="350" id="VALID_DONATIONS" outputFieldNames="true" type="FLAT_FILE_WRITER"/>
<Edge debugMode="all" fromNode="DONATIONS_SPREADSHEET:0" guiBendpoints="" guiRouter="Manhattan" id="Edge0" inPort="Port 0 (in)" metadata="Metadata0" outPort="Port 0 (output)" toNode="VALIDATOR:0"/>
<Edge fromNode="DONATIONS_SPREADSHEET:1" guiBendpoints="" guiRouter="Manhattan" id="Edge3" inPort="Port 0 (in)" outPort="Port 1 (logs)" toNode="CATCH_ERRORS:0"/>
<Edge fromNode="VALIDATOR:0" guiBendpoints="" guiRouter="Manhattan" id="Edge1" inPort="Port 0 (in)" metadata="Metadata1" outPort="Port 0 (valid)" toNode="VALID_DONATIONS:0"/>
<Edge fromNode="VALIDATOR:1" guiBendpoints="" guiRouter="Manhattan" id="Edge2" inPort="Port 0 (in)" metadata="Metadata2" outPort="Port 1 (invalid)" toNode="INVALID_DONATIONS:0"/>
</Phase>
</Graph>
